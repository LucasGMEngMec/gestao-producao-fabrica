<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Gest√£o de Produ√ß√£o</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  padding: 40px;
}

.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #2e7d32;
  color: white;
  padding: 10px 20px;
  margin-bottom: 20px;
}

.topbar button {
  background: #d9534f;
  border: none;
  padding: 6px 12px;
  color: white;
  cursor: pointer;
  border-radius: 4px;
}

.menu {
  max-width: 400px;
  margin: auto;
  background: #fff;
  border: 1px solid #cfcfcf;
  padding: 20px;
}

h2 {
  text-align: center;
}

a {
  display: block;
  padding: 12px;
  margin-top: 10px;
  text-align: center;
  text-decoration: none;
  background: #0070c0;
  color: #fff;
  font-size: 16px;
}

a.grupos {
  background: #2e7d32;
}
</style>

</head>

<body>

<div class="topbar">
  <span id="usuarioInfo"></span>
  <button onclick="logout()">Sair</button>
</div>

<div class="menu">
  <h2>Gest√£o de Produ√ß√£o</h2>

  <a href="apontamento-planilha.html">
    Apontamento de Produ√ß√£o
  </a>

  <a id="linkGrupos" class="grupos" href="grupos.html">
    Cadastro de Grupos
  </a>

  <a id="linkEquipes" class="grupos" href="equipes.html">
    Cadastro de Equipes
  </a>

  <a id="linkCronograma" class="grupos" href="cronograma.html">
    Cadastro de Cronograma
  </a>

  <a id="linkGantt" class="grupos" href="gantt.html">
    Cronograma de Produ√ß√£o
  </a>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://dklmejmlovtcadlicnhu.supabase.co",
  "SUA_CHAVE_PUBLICA_AQUI"
);

// üîê Verifica sess√£o
const { data: { user } } = await supabase.auth.getUser();

if (!user) {
  window.location.href = "login.html";
}

// üîé Busca perfil
const { data } = await supabase
  .from("usuarios_perfil")
  .select("nome, perfil, ativo")
  .eq("id", user.id)
  .single();

const usuarioLogado = {
  id: user.id,
  nome: data?.nome || user.email,
  perfil: data?.perfil || "operador",
  ativo: data?.ativo ?? true
};

if (!usuarioLogado.ativo) {
  alert("Usu√°rio inativo.");
  await supabase.auth.signOut();
  window.location.href = "login.html";
}

// üîê Helper permiss√£o
function temPermissao(perfisPermitidos) {
  return perfisPermitidos.includes(usuarioLogado.perfil);
}

// üë§ Exibir usu√°rio
document.getElementById("usuarioInfo").innerText =
  "Usu√°rio: " + usuarioLogado.nome +
  " | Perfil: " + usuarioLogado.perfil.toUpperCase();

// üéØ MENU DIN√ÇMICO

// Supervisor e Admin veem equipes
if (!temPermissao(["admin","supervisor"])) {
  document.getElementById("linkEquipes").style.display = "none";
}

// Somente Admin v√™ grupos e cronograma
if (!temPermissao(["admin"])) {
  document.getElementById("linkGrupos").style.display = "none";
  document.getElementById("linkCronograma").style.display = "none";
  document.getElementById("linkGantt").style.display = "none";
}

// üö™ Logout
window.logout = async function () {
  await supabase.auth.signOut();
  window.location.href = "login.html";
};
</script>

</body>
</html>
